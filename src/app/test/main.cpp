//=============================================================================
/// @file
/// テストアプリケーション実装ファイル
///
/// テストアプリケーション実装ファイルです。
///
/// @attention なし
//-----------------------------------------------------------------------------

//=============================================================================
// インクルードファイル
//-----------------------------------------------------------------------------
#include "app/test/test.h"
#include "app/test/common/common.h"
#include "app/test/console/console.h"
#include "app/test/window/window.h"
#include "lib/common/common.h"
#include "lib/console/console.h"
#include "lib/window/window.h"

//=============================================================================
// インクルード実装ファイル
//-----------------------------------------------------------------------------
#include "app/program/program.hpp"

//=============================================================================
// 無名名前空間
//-----------------------------------------------------------------------------
namespace {
    //=========================================================================
    // ファイルスコープローカル変数
    //-------------------------------------------------------------------------
    HINSTANCE s_hInstance{}; ///< インスタンスハンドル
}

//=============================================================================
// プログラム名前空間
//-----------------------------------------------------------------------------
namespace program {
    //=========================================================================
    // プログラムクラス
    //-------------------------------------------------------------------------
    // 静的公開関数
    //-------------------------------------------------------------------------
    // メイン関数
    int Program::Main(HINSTANCE hInstance) noexcept {
        // 処理ブロック
        int result{0};
        do {
            // インスタンスハンドル取得
            s_hInstance = hInstance;
            // コンソールコードページ設定
            ::SetConsoleOutputCP(CP_UTF8);
            // 関数情報出力
            std::cout << std::format("-------------------------------------------------------------------------------\n");
            std::cout << std::format("プログラムクラス：メイン関数\n");
            // 共通ライブラリクラスインスタンス取得
            // lib_common::LibCommon::GetInstance();
            // コンソールライブラリクラスインスタンス取得
            // lib_console::LibConsole::GetInstance();
            // ウィンドウライブラリクラスインスタンス取得
            // lib_window::LibWindow::GetInstance();
            // テストアプリケーションクラスインスタンス取得
            app_test::AppTest::GetInstance();
        } while (false);

        // 実行結果
        return result;
    }
}

//=============================================================================
// テストアプリケーション名前空間
//-----------------------------------------------------------------------------
namespace app_test {
    //=========================================================================
    // テストアプリケーションクラス
    //=========================================================================
    // 静的公開関数
    //-------------------------------------------------------------------------
    // インスタンス取得関数
    AppTest& AppTest::GetInstance() noexcept {
        static AppTest s_cInstance; ///< テストアプリケーションクラスインスタンス
        return s_cInstance;
    }

    //=========================================================================
    // 非公開構築子と解体子
    //-------------------------------------------------------------------------
    // コンストラクタ
    AppTest::AppTest() noexcept {
        // 処理ブロック
        do {
            // 関数情報出力
            std::cout << std::format("-------------------------------------------------------------------------------\n");
            std::cout << std::format("テストアプリケーションクラス：コンストラクタ\n");
            // モジュール情報出力
            ::OutputModuleInfo(s_hInstance);
            // テストアプリケーション共通ライブラリクラスインスタンス取得
            LibAppTestCommon::GetInstance();
            // テストアプリケーションコンソールライブラリクラスインスタンス取得
            LibAppTestConsole::GetInstance();
            // テストアプリケーションウィンドウライブラリクラスインスタンス取得
            LibAppTestWindow::GetInstance();
        } while (false);
    }

    //-------------------------------------------------------------------------
    // デストラクタ
    AppTest::~AppTest() noexcept {
        // 処理ブロック
        do {
            // 関数情報出力
            std::cout << std::format("-------------------------------------------------------------------------------\n");
            std::cout << std::format("テストアプリケーションクラス：デストラクタ\n");
        } while (false);
    }
}
